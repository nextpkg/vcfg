# Smart Config Demo Guide

这个演示展示了 vcfg 智能配置管理系统的核心功能，包括插件注册、热重载和配置隔离。

## 快速开始

使用 `demo.sh` 脚本可以快速体验所有功能：

```bash
# 查看帮助
./demo.sh help

# 测试基本 API 功能
./demo.sh api

# 测试配置隔离
./demo.sh isolation

# 测试实时配置变更（带备份恢复）
./demo.sh live

# 测试热重载（交互式）
./demo.sh hotreload

# 运行所有测试
./demo.sh all
```

## 功能说明

### 1. API 测试 (`./demo.sh api`)
- 验证插件注册机制
- 测试插件启动和停止
- 展示插件查询功能
- 显示多实例插件管理

### 2. 配置隔离测试 (`./demo.sh isolation`)
- 模拟单个插件配置变更
- 验证只有特定插件被重载
- 展示智能配置变更检测

### 3. 实时配置测试 (`./demo.sh live`)
- 自动备份和恢复配置文件
- 演示配置隔离机制
- 安全的配置变更测试

### 4. 热重载测试 (`./demo.sh hotreload`)
- 启动配置文件监听
- 支持手动修改 `config.yaml`
- 实时观察配置变更效果
- 按 Ctrl+C 退出

### 5. 完整测试 (`./demo.sh all`)
- 依次运行所有非交互式测试
- 提供完整的功能验证

## 配置文件结构

当前 `config.yaml` 包含以下插件配置：

```yaml
kafka:          # 主 Kafka 插件
kafka1:         # 第二个 Kafka 实例
client:         # 客户端配置
  kafka:        # 客户端 Kafka 配置
redis:          # Redis 插件
```

## 智能配置特性

1. **配置隔离**: 只有配置发生变化的插件会被重载
2. **热重载**: 支持运行时配置更新，无需重启应用
3. **多实例**: 同一类型插件可以有多个实例
4. **自动发现**: 基于配置结构自动注册插件

## 注意事项

- 确保在 `smart_config_demo` 目录下运行脚本
- `hotreload` 命令是交互式的，需要手动修改配置文件
- 脚本会自动处理配置文件的备份和恢复
- 所有测试都是安全的，不会永久修改配置

## 故障排除

如果遇到问题：

1. 检查是否在正确的目录下
2. 确认所有必需文件存在（main.go, plugin_*.go, config.yaml）
3. 验证 Go 环境是否正确配置
4. 查看错误日志获取详细信息